# vim技巧


## 1 .  命令

“." 重复上次修改，修改可以是一个或者多个动作。可以是普通模式下的命令，也可以是从进入插入模式到返回普通模式中间执行的动作。

> G 增加从当前行到文档末尾处的缩进层级,是到文档结尾。
> shift + >> 缩进当前行的缩进层级。


## 2 复合命令

如移动行尾插入，可以的操作为：$ a ===> A.

C 命令：修改到行尾，并进入插入模式
S 命令： 修改一整行，并进入插入模式

## 3 以退为进

指可以先退一步，然后方便一个可以重复的修改，以达到方便使用“."的目的
例如：我们的需求是在+两侧都加上空格
 a+b=c, b+c=d

执行步骤如下：
>
>f+ 找到 +
>s 删除 +， 这即是退
>空格+空格， 前进部分，即可重复的修改
>; 重复查找命令
>. 重复修改

## 4 执行 重复 回退
![](vimages/20200219073426832_23998.png =600x)
其中T，t查找是将光标移动到目标之前一个字符的位置，而F,f则移动到目标位置。


## 5 查找并手动替换

需求，我需要远的文章中的部分content为copy
操作：
> 将光标移动到content单词上，
> * 查找当前光标下的单词
> cwcopyESC  cw 会删除光标位置到单词结束位置的字符，即删除一个单词，并进入编辑模式，输入copy,进入一般模式
> 此时 “.”会将上述操作记录为一次修改
> n 查到下一个content, 然后按点修改即可。

## 6  范式

尽量一键移动一键操作

## 7 普通模式
本小节主要解释了普通模式

## 8 把撤销单元切成块
u命令会撤消最近的操作，尽量将“一次修改” 做成一个块，方便前进或者后退。

## 9 构造可重复的修改
从行尾反向删除一个单词，可以有多种方式：dbx, bdw, daw 其中只有daw可以重复达到反向删除一个单词的目的。


## 10 对数值加减

<C a> <C x>分别对数值进行加减操作，当光标不在数字上，那么会正向查找，并跳过去

## 11 能重复就别用次数

用次的的问题：1.统计需要多少次 2.动作本身可重复性不好。
d3w, 3dw, dw..

## 12 操作符与动作命令结合
d{motion} d为操作符，{motion}为动作命令，操作符决定操作，动作命令决定操作的范围


## 13 在插入模式中更新错误
<c-h> 删除前一个字母（类似退格）
<c-w> 删除前一个单词
<c-u> 删除到行首

## 14 插入-普通模式

<c-o> 在插入模式中执行一条普通模式的命令，执行完回到插入模式

## 15 不离开插入模式，粘贴寄存器中文本
TODO


## 16 运算

## 17 用字符编码插入非常用字符
<C-v>{字符编码}  ==> <C-v>065 会输入A
在字符上按ga 可以分别显示它的不同进制下的字符编码


## 18 用二合字母插入非常用字符
插入模式下 <C k> {char}{char  }
```vim
<C k> ?I ¿
<C k> << «
<C k> >> »
<C k> 34 ¾
:h digraph-table 查看
```

## 19 用替换模式替换已有文本
r用来替换

虚拟替换模式：gR 它会把制表符当一组空格处理
```vim
this    is tabstop
thisIis tabstop  #tab替换成一个字符                                           
thisttttis tabstop #tab替换成4个字符（设置宽度为4）
```

## 21 选择高亮
v 字符级可视模式
Ctrl v 列级可视模式
shift v 行级可视模式
gv 重选上次的高亮选区

重复v可以在普通模式与字符级可视模式间切换，Ctrl v, shift v同理

在可视模式下，按o可以切换选区的两端
<div>one</div>
vit 会选中标签的内容,上面的单词one
vat会选中标签,<div>one</div>
## 22 重复面向行的命令
当缩进需要两次完成时，第一次缩进后会进入到普通模式，此时可以用gv重复选择，然后再次缩进，更简单的做法是在普通模式下 “." 会重复上一次操作。

## 25 修改列文本
ctrl v 进入列模式，移动光标先中要修改的列，c进行修改，修改完退出插入模式，所有列都被修改。

## 26 在长短不一的高亮块后添加文本
当列的长度不同时，比如在不同行的最后面添加分号
ctrl v 进入块模式， jj$ 选中直到最后一列，A 在最后列插入; 退出插入模式，所有列的最后面都添加了；

## 28 在一行或者多个连续行执行命令
可以作为地址的有：
```vim
行号 6  2，5
. 代表当前行。.,$当前行到文件结尾
%代表当前文件中的所有行， %s/old/new/ 替换
'<,>' 高亮选区
<html>,</html>模式 本例指html标签
<html>+1,</html>-1 偏移，当1被省略时默认为1
```
约定：
```vim
1 代表文件第一行
0 虚拟行，代表文件第一行上方，当想插入到文件最前面时使用
$ 文件最后一行
. 当前行
'm 包含位置标记m的行
'< 高亮选区的起始
'> 高亮选区的结尾
% 整个文件
```

## 29 t 和m 命令
:copy 简写为 co
t ==> copy to
m ==> move  （剪切）
```vim
6t. 把第六行复制到当前行下方
t6  把当前行复制到第6行下方
t.  为当前行创建一个副本
t$  把当前行复制到文本结尾
'<,'> 把高亮选区复制到文件开头
```
重复上次的命令行命令@：

## 32 自动补全命令行
ctrl d 会让vim显示可用的实例列表
wildmode 可以定义自动实例行为

bash shell:
```vim
set wildmode=longest,list
```
zsh
```vim
set wildmenu
set wildmode=full
```

## 33 把当前单词插入到命令行中
当光标在某个单词上时，ctrl r ctrl w 会复制当前单词并插入到命令行中。
当我们要修改比如this 改为that
```vim
this
is this
a this
test this
```
可以这么操作，先将光标移到this上 * 会选中所有的this, 但光标会移到到第二个this, cwthat esc
%s//ctrl r ctrl w/g 就可以替换所有的this 为that


## 34 回溯命令历史 
按：即切换到命令行模式，然后up/down即可浏览历史
```vim
q/ 打开查找命令历史的命令行窗口
q: 打开ex命令历史的命令行窗口
ctrl f 命令行模式切换到命令行窗口
```

## 35 执行shell命令
：！ 执行外部命令
：shell 命令进入vim提供的shell
在vim中ctrl z可以挂起vim,让它在后台，在必要时通过fg返回，可以通过$jobs查看当前作业列表

：read！ {cmd} 把cmd这条命令的输出重定向到缓冲区
：write!{cmd} 把缓冲区内容作为cmd这条命令的输入


## 36 缓冲区列表管理打开的文件
命令行下ls查看缓冲区的文件
%指明当前窗口中可见的文件
#则代表轮替文件 ctrl ^ 在文件和轮换文件间切换
:bnext 在缓冲区列表中正向移动
:bprev
:bfirst
:blast
:bdelete 删除缓冲区

## 37 用参数列表将缓冲区分组
当我们通过vim 打开多个文件后，:args 命令能看到参数列表（文件列表），而当我们通过使用通配符的方式就可以达到分组的目的：
比如：：vim *.txt 将所有txt文件读入
      ：    ：vim *.js 讲稿所有js文件
      
## 39 窗口管理
<C w> s 水平分割
<C w> v 垂直分割
当有多个窗口时，默认用的同一个缓冲区，如果在某个窗口载入另一个缓冲区，用：edit filename 命令
或者用下面的命令一步到位：
: sp filename
: vsp filename

窗口间切换：
C -w w 窗口间循环切换
C -w h 移动到左边的窗口
C -w j 移动到下边的窗口
C -w k 移动到上边的窗口
C -w l 移动到右边的窗口

关闭窗口：
：clo 关闭当前活动窗口
:  on 只保留当前窗口

改变窗口大小：
C -w = 使窗口大小相等
C -w _ 使窗口最大高度
C -w | 使窗口最大宽度
N C -w _ 使活动窗口高度为N行
N C -w | 使活动窗口宽度为N列

## 40 标签
：tabedit filename 打开一个新的标签页
C -w T 把当前窗口移动到一个新标签页
：tabc 关闭当前标签页及其中的所有窗口
：tabo 只保留当前标签页
{N}gt 在标签页之间切换 gT 方向相反 此命令是在普通 模式下
:tabn {N},tabn, tabp 此命令在Ex命令模式下
:tabmove N 重新排列标签页，当n为0 则当前页移动到第一个，如果省略n则移动gg末尾
：lcd path 为当前窗口设置本地目录,注意是当前窗口，非当前标签页，如果一个标签页打开了很多窗口，可以通过windo lcd path 设置这些窗口设置本地目录


## 41 ：edit 命令打开文件
edit 命令可依据绝对/相对路径打工文件
当我们在某个目录中编辑文件时，想要 打开同目录下的文件：edit %<TAB> 它会将当前 缓冲区文件路径补全。如果我们想在edit后面加上当前文件路径则应该：edit%:h<tab> 就会展开当前 文件所在的目录路径，再加上文件的部分名，再tab即可补全完整路径。感觉这功能有点鸡肋。

## 42 find打开文件
有时文件存在很多层嵌套，直接打开是无法做到的，可以使用这种方式：set path+= project_path
即将当前项目的目录添加到path中，这样就可以直接用find vim.py 打开文件，即使它是在嵌套的目录内，当存在多个同名文件时默认打开第一个，可以通过按tab键在它们之间切换。

## 44 把文件保存到不存在的目录中
当我们使用edit file 命令时 file的路径不存在，此时vim还是会打开一个缓冲区，但如果你运行：write命令就会出错，此时的解决办法是：先创建目录，再保存：
```vim
:!mkdir -p %:h  # %:h 会转换成当前目录 技巧41,注意这里是用的外部命令！
：write
```

## 45 以超级用户权限保存文件
有些文件只有root用户都有权限，但我们打开编辑时可以编辑，保存时就成了问题，下面就这种情况下的解决办法：
```vim
:w !sudo tee % > /dev/null
```
解释
:write !{CMD} 命令会把缓冲区内容作为标准输入传给指定的{CMD}, {CMD}可以是任何外部命令
tee 命令则将stdin 发送到stdout 或者文件。 
% 在vim命令行中指代当前文件的完整路径
将上面的命令翻译一下：
将缓冲区的内容作为标准输入交给以sudo 命令运行的tee命令，tee命令读取这个标准输入后 将它写入当前文件 并忽略错误信息。

输入上面的命令后，vim会与我们进行再次交互，首先输入当前用户的密码，然后警告文件被修改并弹出圣对话框，建议选择l (load)将该文件重新载入缓冲区。

## 47 区分实际行与屏幕行
j,k 命令根据实际行向上下移动，而gj,gk则按屏幕行上下移动。

## 48 基于单词移动
这四种动作面向单词，即如果单词前有个引号，这个引号也作为一个单词
w    正向移动到下一单词开头
b    反向移动到当前单词/上一单词的开头
e    正向移动到当前单词/下一单词的结尾
ge  反向移动到上一单词的结尾

而大写 W,B,E gE则面向字串，可以移动得更快。单词前的引号与单词组成一个字串

## 49 对字符进行查找
f{char} 正向查找指定的字符，如果找到了光标就停在该字符上
F{char} 反射查找指定字符。
查找到字符后，可能 因为存在相同字符，此时可以通过;重复查找，此时如果不小心跳过了，可以通过，反向回跳。

t{char}正向移动到指定字符前一个字符上
T{char} 反射移动到指定字符后一个字符上
当使用dt{char} 这种操作时就会删除到指定字符之间的内容

## 50 通过查找进行移动
/{word} 正向查找单词，光标停在单词的首字母上，d{motion} 用/{word}删除时d不会删除我们查找 到的单词的首字母，因为它将查找命令当作一个开动作。

## 51 用精确的文本对象选择选区